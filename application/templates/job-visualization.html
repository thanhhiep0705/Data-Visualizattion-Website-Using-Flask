{% extends "layout.html" %} {% block content %}
<div class="py-4 px-5 d-flex flex-column gap-3">
  <div class="d-flex justify-content-between align-items-center flex-row">
    <h2 class="fw-normal">Trực quan hóa dữ liệu tuyển dụng</h2>
    <select class="form-select w-25 h-auto"
            aria-label="Default select example"
            placeholder="Chọn bộ dữ liệu">
      <option value=""
              disabled
              selected>Chọn bộ dữ liệu</option>
      <option value="0">Tất cả</option>
      <option value="1">LinkedIn</option>
      <option value="2">NodeFlair</option>
      <option value="3">Dice</option>
    </select>
  </div>
  <div class="row row-cols-auto gap-3 ms-0">
    <div class="box"
         id="box1">
      <img src="../static/img/posting.png"
           height="40"
           width="40"
           alt="Course icon" />
      <div class="number">{{db_info[0]}}</div>
      <div class="text">Việc làm</div>
    </div>

    <div class="box"
         id="box2">
      <img src="../static/img/subjects.png"
           height="40"
           width="40"
           alt="Course icon" />
      <div class="number">{{db_info[1]}}</div>
      <div class="text">Lĩnh vực</div>
    </div>

    <div class="box"
         id="box3">
      <img src="../static/img/programing_language.png"
           height="40"
           width="40"
           alt="Course icon" />
      <div class="number">{{db_info[2]}}</div>
      <div class="text">Ngôn ngữ lập trình</div>
    </div>

    <div class="box"
         id="box4">
      <img src="../static/img/tool.png"
           height="40"
           width="40"
           alt="Course icon" />
      <div class="number">{{db_info[3]}}</div>
      <div class="text">Công cụ lập trình</div>
    </div>

    <div class="box"
         id="box5">
      <img src="../static/img/framework.png"
           height="40"
           width="40"
           alt="Course icon" />
      <div class="number">{{db_info[4]}}</div>
      <div class="text">Khung chương trình</div>
    </div>
  </div>
  <div>
    <h4>Thống kê theo ngành</h4>
    <div class="row row-cols-auto justify-content-start ms-0 gap-4">
      
      {% for chart in graphsData %}
      {% if chart['haveFilter'] == False %}
      <div class="chart-container col p-0">
        <div class="chart-container-header d-flex justify-content-between align-items-md-center gap-2">
          <span>{{chart['name']}}</span>
          <img type="button"
               data-bs-toggle="modal"
               data-bs-target="#myModal{{chart['chartId']}}"
               src="../static/img/zoom-out.png"
               height="28"
               alt="Zoom icon" />
        </div>
        <div class="chart-container-body flex justify-content-center align-items-center">
          <div class="chart"
               id="{{chart['chartId']}}"></div>
        </div>
      </div>

      <div class="modal"
           id="myModal{{chart['chartId']}}">
        <div class="modal-dialog">
          <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header w-100 bg-light p-4">
              <h3 class="modal-title text-primary fw-bold">{{chart['name']}}</h3>
              <button type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"></button>
            </div>
            <!-- Modal body -->
            <div class="w-100 d-flex justify-content-center align-items-lg-center">
              <div class="chart overflow-auto"
                   id="{{chart['dialogId']}}">
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endif %}
      {% if chart['haveFilter'] == True %}
      <div class="chart-container col p-0">
        <div class="chart-container-header d-flex justify-content-between align-items-md-center gap-2">
          <span>{{chart['name']}}</span>
          <img type="button"
               data-bs-toggle="modal"
               data-bs-target="#myModal{{chart['chartId']}}"
               src="../static/img/zoom-out.png"
               height="28"
               alt="Zoom icon" />
        </div>
        <div class="chart-container-body flex justify-content-center align-items-center">
          <div class="chart"
               id="{{chart['chartId']}}"></div>
        </div>
      </div>

      <div class="modal"
           id="myModal{{chart['chartId']}}">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header w-100 bg-light p-4">
              <h3 class="modal-title text-primary fw-bold">{{chart['name']}}</h3>
              <button type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"></button>
            </div>
            <div class="w-50 m-3">
              <label for="industry-select-{{ loop.index }}"
                     class="pb-1">Chọn ngành</label>
              <select id="industry-select-{{ loop.index }}"
                      aria-label=""
                      class="form-select">
                {% for index, industry in chart['filter'] %}
                <option value="{{ index }}">{{ industry }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="w-100 d-flex justify-content-center align-items-lg-center">
              <div class="chart overflow-auto"
                   id="{{chart['dialogId']}}">
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endif %}
      {% endfor %}

    </div>
  </div>
</div>
<!-- plotly CDN -->

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.0.min.js"></script>
<script type="text/javascript">


  var graphs = {{ graphsData | tojson }};
  var selectedIndustry = [0, 0, 0, 0, 0, 0];
  for (var i = 0; i < graphs.length; i++) {
    var graph = graphs[i];
    var graphData = JSON.parse(graph.graphData);
    var graphDialogData = JSON.parse(graph.graphDialogData);

    if (graph.haveFilter == false) {
      Plotly.plot(graph.chartId, graphData, {});
      Plotly.plot(graph.dialogId, graphDialogData, {});
    }
    else {
      Plotly.plot(graph.chartId, graphData[selectedIndustry[i]], {});
      Plotly.plot(graph.dialogId, graphDialogData[selectedIndustry[i]], {});
    }
  }

  $('#industry-select-3').change(function () {
    selectedIndustry[2] = $(this).val();
    Plotly.react('chart3', JSON.parse(graphs[2].graphData)[selectedIndustry[2]], {});
    Plotly.react('dialog-chart3', JSON.parse(graphs[2].graphDialogData)[selectedIndustry[2]], {});
  });
  $('#industry-select-4').change(function () {
    selectedIndustry[3] = $(this).val();
    Plotly.react('chart4', JSON.parse(graphs[3].graphData)[selectedIndustry[3]], {});
    Plotly.react('dialog-chart4', JSON.parse(graphs[3].graphDialogData)[selectedIndustry[3]], {});
  });
  $('#industry-select-5').change(function () {
    selectedIndustry[4] = $(this).val();
    Plotly.react('chart5', JSON.parse(graphs[4].graphData)[selectedIndustry[4]], {});
    Plotly.react('dialog-chart5', JSON.parse(graphs[4].graphDialogData)[selectedIndustry[4]], {});
  });

</script>

{% block css %}
<link rel="stylesheet"
      href="{{ url_for('static', filename='css/dialog.css') }}" />
<link rel="stylesheet"
      href="{{ url_for('static', filename='css/visualization.css') }}" />
{% endblock %} {% endblock %}